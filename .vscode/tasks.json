{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "MCU menuconfig",
      "type": "shell",
      "command": "make -C klipper menuconfig",
      "presentation": { "reveal": "always", "panel": "dedicated" }
    },

    {
      "label": "Build MCU firmware",
      "type": "shell",
      "command": "make -C klipper clean && make -C klipper -j$(nproc)",
      "group": "build",
      "problemMatcher": []
    },

    {
      "label": "Flash to Manta (Katapult)",
      "type": "shell",
      "dependsOn": "Build MCU firmware",

      // â†“ Everything is inside one bash-c string, so JSON needs no back-slash escapes
      "command": "bash",
      "args": [
        "-c",
        "scp klipper/out/klipper.bin klipper:/tmp && ssh klipper 'sudo service klipper stop && python3 ~/katapult/scripts/flashtool.py -i can0 -r -u 09ee31594ced && python3 ~/katapult/scripts/flashtool.py -f /tmp/klipper.bin -d /dev/serial/by-id/usb-katapult_stm32g0b1xx_3200130008504E5238363120-if00 && sudo service klipper start'"
      ],

      "group": { "kind": "build", "isDefault": true },
      "problemMatcher": []
    }
  ]
}
